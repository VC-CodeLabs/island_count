"""
    Island counter solution
    t-REveor
    hyper effficient?
"""

import time

debug = True


def read_data_file(filename):
    f = open(filename)
    lines = f.readlines()
    island_maps = []
    island_map = []
    for line in lines:
        if len(line) < 2:
            island_maps.append(island_map)
            island_map = []
        else:
            island_map.append([str(c) for c in line[:-1]])
    if len(lines[-1]) > 1:
        island_maps.append(island_map)
    return island_maps


def get_island_maps():
    island_maps = []
    island_maps.append([
        ["1", "1", "0", "0", "0"],
        ["1", "1", "0", "0", "0"],
        ["0", "0", "1", "0", "0"],
        ["0", "0", "0", "1", "1"]
    ])
    island_maps.append([
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "0"],
        ["1", "1", "1", "1", "1", "1", "1", "0", "0", "0"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "0", "0"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "0"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "1"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "0", "0"],
        ["0", "0", "0", "1", "1", "1", "1", "0", "0", "0"]
    ])
    island_maps.append([
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "0"],
        ["1", "1", "1", "1", "1", "1", "1", "0", "0", "0", "1", "1", "1", "1", "1", "0", "1", "0"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "0", "0", "1", "0", "0", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "0", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "1", "0", "1", "0", "1", "1", "0", "0", "1"],
        ["0", "0", "1", "1", "0", "1", "1", "0", "0", "1", "1", "1", "0", "1", "1", "0", "1", "0"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1"],
        ["0", "0", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "1", "0", "0", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "0", "0", "1", "1", "1", "1", "1", "1", "0", "0", "1", "1", "1", "1", "0"],
        ["0", "0", "0", "1", "1", "1", "1", "0", "0", "0", "0", "1", "1", "1", "1", "0", "0", "0"]
    ])
    island_maps.append([
        ["1", "1", "0", "0", "0", "1", "1", "0", "1", "0", "0", "0", "0", "1", "1", "0", "1", "0"],
        ["1", "1", "1", "1", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "0", "1", "0"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "1", "0", "1", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "0", "0", "1", "1", "1", "0", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "1", "0", "0", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "0", "0", "1", "1", "1", "1", "1"],
        ["0", "0", "0", "1", "1", "1", "1", "0", "0", "0", "0", "1", "1", "1", "1", "0", "0", "1"]
    ])
    island_maps.append([
        ["1", "1", "0", "0", "0", "1", "1", "0", "1", "0", "0", "0", "0", "1", "1", "0", "1", "0", "1", "0", "0", "0",
         "1", "1", "0", "1", "0", "0", "0", "0", "1", "1", "0", "1", "0"],
        ["1", "1", "1", "1", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1",
         "1", "1", "0", "1", "0", "1", "1", "1", "0", "1", "0", "1", "0"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "1", "0", "1", "0", "0",
         "1", "1", "0", "1", "1", "1", "0", "0", "0", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "1", "0", "0", "0", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "1", "1", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "1", "0", "1", "1", "0",
         "1", "1", "0", "0", "1", "1", "0", "0", "0", "1", "0", "0", "1"],
        ["1", "1", "0", "1", "0", "0", "1", "0", "0", "0", "0", "1", "0", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "0", "1", "0", "0", "1", "0", "1", "0", "0", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "0", "1", "0", "0", "1", "1", "1", "0", "1", "1", "0", "1", "1", "1", "1", "1", "0",
         "0", "1", "0", "0", "1", "1", "1", "0", "0", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "0", "1", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "1", "0",
         "0", "1", "0", "0", "0", "0", "0", "1", "0", "1", "0", "1", "1"],
        ["0", "1", "1", "1", "0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "1", "1", "1", "0",
         "0", "1", "0", "0", "1", "1", "0", "1", "0", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "0", "1", "0", "0", "1", "0", "0", "1", "1", "1", "0", "0", "1", "1", "0", "0", "0",
         "0", "1", "0", "0", "1", "0", "0", "1", "0", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "0", "1", "1", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "0",
         "0", "1", "1", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1"],
        ["0", "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1", "0", "1", "0", "0",
         "0", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "0", "1", "1", "0",
         "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "0",
         "1", "1", "1", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1", "0", "1", "0", "0",
         "1", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "0", "1", "1", "0",
         "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "1", "0", "1", "0", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "0", "1", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "0", "0", "1", "1", "1", "0", "1", "1", "0", "1", "1", "1", "1", "1", "0",
         "0", "0", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1"],
        ["0", "1", "1", "1", "0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "1", "1", "1", "0",
         "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "0", "1", "0", "0", "1", "0", "0", "1", "1", "1", "0", "0", "1", "1", "0", "0", "0",
         "0", "1", "0", "0", "0", "0", "0", "1", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "0", "1", "1", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "1", "1", "1", "0",
         "0", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "1"],
        ["0", "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1", "0", "1", "0", "0",
         "0", "1", "0", "1", "0", "1", "0", "1", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "0", "1", "1", "0",
         "0", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "0", "0", "0", "0", "0", "0", "0", "0", "0", "1", "0",
         "1", "1", "1", "1", "0", "1", "0", "1", "1", "1", "1", "1", "1"],
        ["0", "0", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "1", "1", "1", "0", "1", "1", "0", "1", "0", "0",
         "1", "1", "0", "1", "0", "1", "0", "1", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "0", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "1", "1", "1", "0", "0", "1", "0", "1", "1", "0",
         "1", "1", "0", "0", "0", "1", "0", "1", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "1", "0", "1", "0", "1", "1", "0", "0", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "0", "1", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "0", "0", "1", "1", "1", "0", "1", "1", "0", "1", "1", "1", "1", "1", "0",
         "1", "1", "0", "0", "0", "1", "1", "0", "1", "1", "0", "1", "1"],
        ["1", "1", "0", "1", "0", "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1", "1", "0", "1", "0",
         "1", "1", "0", "0", "0", "0", "0", "0", "1", "1", "0", "1", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "1", "1", "0",
         "1", "1", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "1"],
        ["1", "1", "0", "0", "0", "1", "1", "0", "0", "1", "0", "0", "0", "1", "1", "0", "0", "1", "1", "0", "0", "0",
         "1", "1", "0", "0", "1", "0", "0", "0", "1", "1", "0", "0", "1"],
        ["0", "1", "1", "1", "0", "1", "1", "1", "1", "1", "1", "0", "0", "1", "1", "1", "1", "1", "1", "1", "1", "0",
         "1", "1", "1", "1", "1", "1", "0", "0", "1", "1", "1", "1", "1"],
        ["0", "0", "0", "1", "1", "1", "1", "0", "0", "0", "0", "1", "1", "1", "1", "0", "0", "1", "0", "0", "1", "1",
         "1", "1", "0", "0", "0", "0", "1", "1", "1", "1", "0", "0", "1"]
    ])
    island_maps.append([
        ["1", "1", "0", "0", "0"],
        ["1", "1", "0", "0", "0"],
        ["0", "0", "1", "0", "0"],
        ["0", "0", "0", "1", "1"]
    ])

    island_maps = island_maps + read_data_file('trevorw_data.txt')

    if debug:
        for i in range(len(island_maps)):
            print(f'Island map {i + 1} width: {len(island_maps[i][0])}, height: {len(island_maps[i])}')

    return island_maps


def merge_buckets(island_buckets, w, n):
    # say merge_buckets([[3, 2], [1], [4, 5], [6]], 2, 6) should return [[3, 2, 6], [1], [4, 5]]
    merged_bucket = [c for bucket in island_buckets for c in bucket if w in bucket or n in bucket]
    other_buckets = [bucket for bucket in island_buckets if w not in bucket and n not in bucket]
    return [merged_bucket] + other_buckets


def get_island_count(island_map):
    c = 1
    island_buckets = []
    for j in range(len(island_map)):
        for i in range(len(island_map[0])):
            if island_map[j][i] == "1":
                w = island_map[j][i - 1] if i > 0 and island_map[j][i - 1] not in ["0", "1"] else None
                n = island_map[j - 1][i] if j > 0 and island_map[j - 1][i] not in ["0", "1"] else None
                if w is None and n is None:
                    island_buckets.append([c])
                    island_map[j][i] = c
                    c += 1
                elif w is None and n is not None:
                    island_map[j][i] = n
                elif w is not None and n is None:
                    island_map[j][i] = w
                elif any([bucket for bucket in island_buckets if w in bucket and n in bucket]):
                    island_map[j][i] = n
                else:
                    island_buckets = merge_buckets(island_buckets, w, n)
                    island_map[j][i] = n

    return len(island_buckets)


def main():
    data = get_island_maps()

    n = 1
    for island_map in data:
        start = time.perf_counter_ns()
        island_count = get_island_count(island_map)
        end = time.perf_counter_ns()
        print(f'Island {n}, width: {len(island_map[0])}, height: {len(island_map)}, island count: {island_count}, time taken: {round(end - start, 6)} ns')
        n = n + 1


if __name__ == '__main__':
    main()
